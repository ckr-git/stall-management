# 摊位管理平台 - 启动说明

## 1. 环境准备

### 必需软件
- **JDK 17** 或更高版本
- **Maven 3.6+**
- **MySQL 8.0+**
- **Redis 6.0+**（可选，用于缓存）
- **Node.js 16+**（前端开发）
- **IDEA** 或其他Java IDE

## 2. 数据库配置

### 创建数据库
```sql
-- 方式1：直接在MySQL中执行database.sql文件
mysql -u root -p < database.sql

-- 方式2：使用MySQL客户端工具导入database.sql
```

### 修改数据库连接
打开 `src/main/resources/application.yml`，修改数据库配置：
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/stall_platform?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root          # 改成你的MySQL用户名
    password: root          # 改成你的MySQL密码
```

## 3. 启动Redis（可选）

### Windows
```bash
redis-server.exe redis.windows.conf
```

### Linux/Mac
```bash
redis-server
```

## 4. 启动后端

### 方式1：使用Maven命令
```bash
# 在项目根目录执行
mvn spring-boot:run
```

### 方式2：使用IDEA
1. 用IDEA打开项目
2. 等待Maven依赖下载完成
3. 找到 `StallPlatformApplication.java`
4. 右键选择 `Run 'StallPlatformApplication'`

### 验证启动成功
- 看到控制台输出：`摊位管理平台启动成功！`
- 后端API地址：http://localhost:8080/api

## 5. 初始化测试数据

### 生成BCrypt加密密码
使用在线工具或Java代码生成BCrypt密码：
```java
BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();
String password = encoder.encode("admin123");
System.out.println(password);
```

### 创建管理员账号
```sql
-- 在数据库中执行（请替换$2a$10$...为实际生成的BCrypt密码）
INSERT INTO `user` (username, password, nickname, phone, role, status) 
VALUES ('admin', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVKIUi', '系统管理员', '13800138000', 'ADMIN', 1);
-- 密码: admin123
```

### 创建测试用户
```sql
INSERT INTO `user` (username, password, nickname, phone, role, status) 
VALUES ('user', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVKIUi', '测试用户', '13900139000', 'USER', 1);
-- 密码: user123
```

### 创建摊位类型
```sql
INSERT INTO `stall_type` (name, description, sort_order) VALUES 
('餐饮摊位', '提供餐饮服务的摊位', 1),
('零售摊位', '销售商品的摊位', 2),
('娱乐摊位', '提供娱乐服务的摊位', 3),
('手工艺摊位', '手工艺品展示销售', 4);
```

### 创建测试摊位
```sql
INSERT INTO `stall` (stall_no, name, type_id, location, area, rent_price, status, description) VALUES 
('A001', '1号餐饮摊位', 1, '公园东门附近', 10.5, 1200.00, 0, '位置优越，人流量大'),
('A002', '2号零售摊位', 2, '公园中心广场', 8.0, 1000.00, 0, '中心位置，适合零售'),
('B001', '3号娱乐摊位', 3, '公园游乐区', 15.0, 1500.00, 0, '靠近游乐设施');
```

## 6. 启动前端

### 安装依赖
```bash
cd frontend
npm install
```

### 启动开发服务器
```bash
npm run dev
```

### 访问前端
打开浏览器访问：http://localhost:5173

## 7. 测试功能

### 登录测试
1. 访问前端地址：http://localhost:5173
2. 使用管理员账号登录：
   - 用户名：admin
   - 密码：admin123

### 测试摊位用户功能
1. 注册新账号或使用测试账号登录（user/user123）
2. 浏览摊位列表
3. 提交摊位申请
4. 查看申请进度
5. 提交反馈投诉

### 测试管理员功能
1. 使用admin账号登录
2. 进入管理后台
3. 管理摊位信息
4. 审核摊位申请
5. 处理用户反馈
6. 发布系统公告

## 8. 常见问题

### Q1: 启动时提示数据库连接失败
**A:** 检查MySQL服务是否启动，数据库名、用户名、密码是否正确。

### Q2: Maven依赖下载很慢
**A:** 配置Maven国内镜像，编辑 `~/.m2/settings.xml`：
```xml
<mirror>
  <id>aliyun</id>
  <mirrorOf>central</mirrorOf>
  <name>Aliyun Maven</name>
  <url>https://maven.aliyun.com/repository/public</url>
</mirror>
```

### Q3: 前端npm install失败
**A:** 
- 切换npm镜像源：`npm config set registry https://registry.npmmirror.com`
- 清除缓存：`npm cache clean --force`

### Q4: 登录后提示token验证失败
**A:** 
- 检查JWT配置是否正确
- 确认前端请求头是否携带Authorization: Bearer {token}

### Q5: JDK版本不对
**A:** SpringBoot3要求JDK17+，请确保安装了正确的JDK版本。

## 9. 项目打包

### 后端打包
```bash
mvn clean package
# 打包后的jar文件在 target/ 目录下
```

### 前端打包
```bash
cd frontend
npm run build
# 打包后的文件在 dist/ 目录下
```

## 10. 部署建议

### 后端部署
```bash
# 运行打包好的jar文件
java -jar stall-management-platform-1.0.0.jar
```

### 前端部署
将 `frontend/dist/` 目录下的文件部署到Nginx或其他Web服务器。

### Nginx配置示例
```nginx
server {
    listen 80;
    server_name your_domain.com;
    
    location / {
        root /var/www/stall-frontend;
        index index.html;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://localhost:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 技术支持

如遇到问题，请检查：
1. 所有环境是否正确安装（特别注意JDK17+）
2. 配置文件是否正确修改
3. 端口是否被占用（8080, 5173, 3306, 6379）
4. 日志输出的错误信息

项目地址：[GitHub链接]
